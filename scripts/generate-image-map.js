const fs = require("fs");
const path = require("path");

// Polyfill __dirname for ES modules
const __dirname = path.dirname(new URL(import.meta.url).pathname);

// Config
const assetsDir = path.resolve(__dirname, "..", "assets", "gods");
const outFile = path.resolve(
  __dirname,
  "..",
  "app",
  "utils",
  "generatedImageMap.ts"
);

const files = fs
  .readdirSync(assetsDir)
  .filter((f) => /\.(png|jpe?g|webp|gif|svg)$/i.test(f));

const lines = [];
lines.push("// This file is auto-generated by scripts/generate-image-map.js");
lines.push("// Do not edit by hand.");
lines.push("");
lines.push("export const imageMap: Record<string, any> = {");
for (const f of files) {
  const rel = path
    .relative(path.dirname(outFile), path.join(assetsDir, f))
    .replace(/\\/g, "/");
  const key = f.toLowerCase();
  lines.push(`  "${key}": require("${rel}"),`);
}
lines.push("};");
lines.push("");
lines.push("export function getImage(filename?: string) {");
lines.push("  if (!filename) return undefined;");
lines.push("  return imageMap[filename.toLowerCase()];");
lines.push("}");

fs.writeFileSync(outFile, lines.join("\n"));
console.log("Generated", outFile);
